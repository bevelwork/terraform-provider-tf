services:
  factorio:
    image: factoriotools/factorio:latest
    container_name: factorio
    restart: unless-stopped
    ports:
      - "0.0.0.0:34197:34197/udp"
      - "0.0.0.0:27015:27015/tcp"
    volumes:
      - ./examples/hello-world/scripts/factorio-volume:/factorio
    environment:
      # Disable DLC mods
      - PRESET=rich-resources 
      - DLC_SPACE_AGE=base
      - RCON_PASSWORD=${RCON_PASSWORD:-password}
      - LOAD_LATEST_SAVE=true
      - GENERATE_NEW_SAVE=true
      - SAVE_NAME=terraform-world
    # Health check to ensure server is running
    healthcheck:
      test: ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/27015' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
